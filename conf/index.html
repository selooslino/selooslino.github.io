<!DOCTYPE html>
<html>
    <head>
        <title>conf</title>
        <meta charset="utf-8">
        <script type="text/javascript" src="https://unpkg.com/voximplant-websdk@beta"></script>
        <style>
            body {background-color: black; color: lime;}
            video {width: 25%;border-radius: 10px;}
            /* #voximplantlocalvideo { position: absolute; right: 0; } */
        </style>
    </head>
<body>
    <span id="localvideo"></span>

    <script>
let conf;
const letsdoit = async () => {
    const sdk = VoxImplant.getInstance();
    try {
        await sdk.init({
            localVideoContainerId: "localvideo"
        });
        try {
            await sdk.connect();
        } catch (e) {
            document.body.insertAdjacentHTML('beforeend', "<p>Connection failed! Check your internet and reload the page.</p><button onclick='location.reload()'>Reload?</button>");
        }
        try {   
            await sdk.login("guest@conftest.avicus.n4.voximplant.com","guestuser");
            const callSettings = { number: "test", simulcast: true, video: { sendVideo: true, receiveVideo: true } };
            conf = sdk.callConference(callSettings);
            conf.addEventListener(VoxImplant.CallEvents.Connected, (e) => {
                sdk.showLocalVideo(true);
                e.call.on(VoxImplant.CallEvents.EndpointAdded, (e) => {
                    const tmpl = `<div id="${e.endpoint.id}"></div>`;
                    document.body.insertAdjacentHTML('beforeend', tmpl);
                    e.endpoint.on(VoxImplant.EndpointEvents.RemoteMediaAdded, (e) => {
                        e.mediaRenderer.render(document.getElementById('e.endpoint.id'));
                    });
                });
            });
        } catch (e) {
            document.body.insertAdjacentHTML('beforeend', "<p>Login failed! Probably Avi deleted the user.");
        }
    } catch (e) { location.reload(); }
};

letsdoit();
    </script>
    </body>
</html>