<!DOCTYPE html>
<html>
    <head>
        <title>conf</title>
        <meta charset="utf-8">
        <script type="text/javascript" src="https://unpkg.com/voximplant-websdk@beta"></script>
        <style>
            body {background-color: black; color: lime; font-family: 'Courier New', Courier, monospace;}
            video {width: 25%;border-radius: 10px;}
            /* #voximplantlocalvideo { position: absolute; top: 10px; right: 10px; } */
        </style>
    </head>
<body>
    <div id="local">
        <br><br>Это видео перехуйница, которую Ави написал на коленке с целью тестов.
        <br><br> Можно будет потом забубенить видеозвонки или видеоконфы нассайт Ослино.
        <br> Сверху справа отображается своё видео, ниже появляются другие участники.
        <br><br> Кароч потестируйте, потом скажите, пригодится или нет, научу, как делать.
        <br><br><button onclick="letsdoit()" id="letsdoit">Поехали, блять!</button>
        <button onclick="fuckthis()" id="fuckthis" style="display: none;">Всё, хватит.</button>
        <br><br>
    </div>
    <script>
let conf;

const letsdoit = async () => {
    const sdk = VoxImplant.getInstance();
    try {
        await sdk.init({
            localVideoContainerId: "local"
        });
        try {
            await sdk.connect();
        } catch (e) {
            document.body.insertAdjacentHTML('beforeend', "<p>Connection failed! Check your internet and reload the page.</p><button onclick='location.reload()'>Reload?</button>");
        }
        try {   
            await sdk.login("guest@conftest.avicus.n4.voximplant.com","guestuser");
            const callSettings = { number: "test", simulcast: true, video: { sendVideo: true, receiveVideo: true } };
            conf = sdk.callConference(callSettings);
            conf.addEventListener(VoxImplant.CallEvents.Connected, (e) => {
                document.getElementById("letsdoit").style.display = "none";
                document.getElementById("fuckthis").style.display = "block";
                sdk.showLocalVideo(true);
                e.call.on(VoxImplant.CallEvents.EndpointAdded, (e) => {
                    const tmpl = `<div id="${e.endpoint.id}"></div>`;
                    document.body.insertAdjacentHTML('beforeend', tmpl);
                    e.endpoint.on(VoxImplant.EndpointEvents.RemoteMediaAdded, (e) => {
                        e.mediaRenderer.render(document.getElementById(e.endpoint.id));
                    });
                });
            });
        } catch (e) {
            document.body.insertAdjacentHTML('beforeend', "<p>Login failed! Probably Avi deleted the user.");
        }
    } catch (e) { location.reload(); }
};

const fuckthis = () => {
    conf.hangup();
    document.getElementById("local").innerHTML = "<br><br>Конфа закрыта.<br><br>Ну как вам, заебись, или хуёво?"
}
    </script>
    </body>
</html>